!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("fortressdb"),require("FDBLib").Components):"function"==typeof define&&define.amd?define("fortressdb",["fortressdb"],t):"object"==typeof exports?exports.fortressdb=t(require("fortressdb"),require("FDBLib").Components):(e.fortressdb=e.fortressdb||{},e.fortressdb.pages=e.fortressdb.pages||{},e.fortressdb.pages.upgrade=t(e.fortressdb,e.FDBLib.Components))}(self,(function(e,t){return(()=>{"use strict";var r={4166:t=>{t.exports=e},4076:e=>{e.exports=t}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var a=n[e]={exports:{}};return r[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return(()=>{o.r(a),o.d(a,{render:()=>E});const e=window.wp.element,t=window.React;var r=o(4076),n=o(4166);function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t,r,n,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){i(a,n,o,c,s,"next",e)}function s(e){i(a,n,o,c,s,"throw",e)}c(void 0)}))}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],c=!0,i=!1;try{for(r=r.call(e);!(c=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);c=!0);}catch(e){i=!0,o=e}finally{try{c||null==r.return||r.return()}finally{if(i)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const p=window.regeneratorRuntime;var f=o.n(p),b=r.Utils.useDictionary;function d(){var o=(0,t.useContext)(r.Popup.Context),a=b();return(0,e.createElement)(n.Layout,{type:"col relative"},(0,e.createElement)(n.Layout,{type:"row"},a("thanks-for-purchase")),(0,e.createElement)(n.Layout,{type:"row",style:{paddingTop:"0.75em"}},(0,e.createElement)(r.Button,{onClick:o},a("close"))))}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}d.displayName="PaymentSuccess";var v=r.Utils.useDictionary,g=r.Utils.loadStripe,h="fortressdb-page-upgrade",w="success";function C(){var a=l((0,t.useState)(null),2),c=a[0],i=a[1],u=l((0,t.useState)(!1),2),p=u[0],b=u[1],m=l((0,t.useState)(null),2),C=m[0],S=m[1],E=l((0,t.useState)(!1),2),x=E[0],P=E[1],O=(0,t.useContext)(n.App.Context).state,k=O.license,j=O.options,_=O.billingPortalUrl,L=(0,t.useCallback)((function(){P("SUBSCRIPTION_CANCEL")}),[]),N=(0,t.useCallback)(function(){var e=s(f().mark((function e(t){var r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.socket.post("payments-session",{data:[{plan:t,coupon:(C||{}).id||"",email:j.email,location:j.useCustomServer?"custom":j.location,success:"".concat(o.g.location.href).concat(o.g.location.search?"&":"?").concat(w),cancel:o.g.location.href}],context:{}});case 3:if(!(r=e.sent).redirect){e.next=7;break}return o.g.location.href=r.redirect,e.abrupt("return");case 7:if(!r.publishableKey){e.next=14;break}return e.next=10,g(r.publishableKey);case 10:if(a=e.sent,r.id){e.next=13;break}throw new Error("Stripe service is unavailable.");case 13:return e.abrupt("return",a&&a.redirectToCheckout({sessionId:r.id}).then((function(e){var t=e.error;if(t)throw t})).catch(i));case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),i(e.t0.message);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),[C,j]),A=(0,t.useCallback)(s(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.socket.delete("subscriptions",{context:{email:j.email,location:j.useCustomServer?"custom":j.location}});case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)}))),[j]),D=(0,t.useCallback)((function(){P(!1)}),[]);(0,t.useEffect)((function(){var e=new URLSearchParams(o.g.location.search);if(e.has(w)){e.delete(w);var t=o.g.location,r=t.origin,n=t.pathname,a=e.toString(),c=r+n+(a?"?".concat(a):"");o.g.history.replaceState(o.g.history.state,"",c),P("PAYMENT_SUCCESS")}}),[]);var T=(0,t.useMemo)((function(){return((k||{}).plans||[]).map((function(e){return e.period.some((function(e){return e.id===k.currentPlanId}))?y(y({},e),{},{tag:"current"}):e}))}),[k]),U=v(),I=(0,t.useCallback)((function(e){S(e)}),[]),M=(0,t.useCallback)((function(e){b(e)}),[]),B=(0,t.useCallback)((function(e){e.preventDefault(),o.g.open(_,"_blank")}));return T.length>0&&(0,e.createElement)(n.Layout,{type:"col flex content",className:h},(0,e.createElement)(r.Popup.Switcher,{active:x,onClose:D},(0,e.createElement)(d,{popup:{id:"PAYMENT_SUCCESS",title:U("payment-success")}}),(0,e.createElement)(r.Confirm,{popup:{id:"SUBSCRIPTION_CANCEL",title:U("subscription-cancel")},question:U("please-confirm"),onConfirm:A})),(0,e.createElement)(r.Notify,{message:c,wide:!0,style:{maxWidth:"25em"},onClear:function(){return i(null)}}),(0,e.createElement)(n.Layout,{type:"row flex align bottom space between",className:"".concat(h,"__header")},(0,e.createElement)(n.Layout,{type:"row align bottom"},(0,e.createElement)(n.Layout,{type:"background contain",className:"fortressdb-logo"}),(0,e.createElement)(n.Layout,{className:"".concat(h,"__title")},U("available-licenses")),_&&(0,e.createElement)(n.Layout,{className:"".concat(h,"__customer_portal_link")},(0,e.createElement)(r.Button,{onClick:B},U("stripe-portal-link")))),(0,e.createElement)(n.Coupon,{onDiscount:I,onFetching:M})),(0,e.createElement)(n.Layout,{type:"row"},T.map((function(t,r){return(0,e.createElement)(n.TariffPlan,{key:t.name,plan:t,planNumber:r+1,licensePlanId:k.currentPlanId,licenseStatus:k.status,discount:C,disabled:p,onPay:N,onUnsubscribe:L,upgrade:!0})}))))}var S=r.Utils.renderDOM;function E(t){S((0,e.createElement)(n.App.Provider,{license:!0},(0,e.createElement)(n.App.Component,null,(0,e.createElement)(C,null))),t)}})(),a})()}));